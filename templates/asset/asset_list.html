{% extends '_base.html' %}
{% load staticfiles %}

{% block title %}DtOps | 资产列表{% endblock %}
{% block custom_css %}
    <link href="{% static 'css/plugins/dataTables/datatables.min.css' %}" rel="stylesheet">
{#        <script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>#}
{% endblock %}

{% block content %}
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
            <h2>资产列表</h2>
            <ol class="breadcrumb">
                <li>
                    <a href="{% url 'index' %}">总览</a>
                </li>
                <li>
                    <a>资产列表</a>
                </li>
                {#                        <li class="active">#}
                {#                            <strong>数据表格</strong>#}
                {#                        </li>#}
            </ol>
        </div>
        <div class="col-lg-2">

        </div>
    </div>

    <div class="ibox-content">
        <div class="" id="content_start">
            <div class="html5buttons">
                <div class="dt-buttons btn-group">
                    <a class="btn btn-default btn_import" data-toggle="modal" data-target="#user_import_modal"
                       tabindex="0">
                        <span>导入</span>
                    </a>
                    <a class="btn btn-default btn_export" tabindex="0">
                        <span>导出</span>
                    </a>
                </div>
            </div>

        </div>

        <div class="uc pull-left m-r-5">
            <a href="{% url 'asset:asset_add' %}" class="btn btn-sm btn-primary">新建资产 </a>
        </div>
{#        <a class="btn btn-sm btn-default btn-add" data-toggle="modal" data-target="#AddHostModal" data-backdrop='static'>#}
{#                    <i class="fa fa-plus"></i> 添加主机#}
{#        </a>#}
{#         <a class="btn  btn-sm btn-default btn-add" data-toggle="modal" data-target="#myModal"  data-backdrop='static'>#}
{#                    <i class="fa fa-plus"></i> 添加主机#}
{#                </a>#}
        <div id="user_list_table_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
            <div id="uc" class="pull-left">

            </div>
            <form  method="GET" action="{% url 'asset:asset_list' %}" class="form-horizontal">
            <div id="asset_list_table_filter" class="dataTables_filter">
                <label>搜索</label>
                    <input type="search" class="form-control input-sm" name="search" placeholder="请输入..." aria-controls="asset_list_table">

            </div>
            </form>

            <table class="table table-striped table-bordered table-hover  dataTable no-footer dataTables-asset">
                <thead>
                <tr role="row">
                    {#            <th class="text-center sorting_disabled" rowspan="1" colspan="1" aria-label="" style="width: 75px;">#}
                    {#                <input id="" type="checkbox" class="ipt_check_all">#}
                    {#            </th>#}
                    <th width="20" class="text-center"><input type="checkbox" id="CheckedAll"></th>
                    <th class="text-center sorting">主机名</th>
                    <th class="text-center sorting">内网IP</th>
                    <th class="text-center sorting">外网IP</th>
                    <th class="text-center sorting">端口</th>
                    <th class="text-center sorting">内存</th>
                    <th class="text-center sorting">磁盘</th>
                    <th class="text-center sorting">CPU核数</th>
                    <th class="text-center sorting">系统版本</th>
                    <th class="text-center sorting">状态</th>
                     <th class="text-center sorting">产品线</th>
{#                    <th class="text-center sorting">备注</th>#}
{#                          <th class="text-center sorting">标签</th>#}
{#                          <th class="text-center sorting">云平台</th>#}
{#                          <th class="text-center sorting">创建用户</th>#}

                    {#            <th class="text-center sorting" tabindex="0" aria-controls="user_list_table" rowspan="1" colspan="1" aria-label="激活中: activate to sort column ascending" style="width: 200px;">激活中</th>#}
                    <th class="text-center sorting">动作</th>
                </tr>
                </thead>

                <tbody>
                {% for asset_list in asset_list.object_list %}
                    <tr role="row" class="gradeA" id="{{ asset_list.id }}">

                        {#        <td class=" text-center">#}
                        {#         <input type="checkbox" class="text-center ipt_check" id="{{ user_list.id }}">#}
                        {#        </td>#}
                        <td class=" text-center"><input type="checkbox" value="{{ asset_list.id }}" name="id"></td>
                        <td class=" text-center"><a href="{% url 'asset:asset_detail' asset_list.id %}">{{ asset_list.hostname }}</a></td>
                        <td class=" text-center">{{ asset_list.inner_ip }}</td>
                        <td class=" text-center">{{ asset_list.pub_ip|default:'N/A' }}</td>

                        <td class=" text-center">{{ asset_list.port }}</td>
                        <td class=" text-center">{{ asset_list.mem_total|default:'N/A' }}</td>
                            <td class=" text-center">{{ asset_list.disk_total|default:'N/A' }}</td>
                              <td class=" text-center">{{ asset_list.osfinger|default:'N/A' }}</td>
                              <td class=" text-center">{{ asset_list.num_cpus|default:'N/A' }}</td>
                              <td class=" text-center">{{ asset_list.status }}</td>
                              <td class=" text-center">{{ asset_list.product.name|default:'N/A' }}</td>
{#                              <td class=" text-center">{{ asset_list.detail|default:'N/A' }}</td>#}
{#                              <td class=" text-center">{{ asset_list.tag.name|default:'N/A' }}</td>#}
{#                              <td class=" text-center">{{ asset_list.cloud_platform.name|default:'N/A' }}</td>#}
{#                              <td class=" text-center">{{ asset_list.create_user|default:'N/A' }}</td>#}

                        <td class=" text-center">
                            <a href="{% url 'asset:asset_detail' asset_list.id %}" class="btn btn-xs btn-info">详情</a>
                            <button class="btn btn-xs btn-danger m-l-xs asset_del" id="{{ asset_list.id }}">删除</button>

                            {#              <button class="btn btn-xs btn-danger m-l-xs system_user_del" id="{{ user_list.id }}">删除</button>#}
                        </td>
                    </tr>
                {% endfor %}

                    </tbody>
                    {#    <div class="row m-t"><div class="col-md-8"><div id="op" class="col-md-6">#}
            </table>
         <div>
             <ul class="pagination pull-right">
                                        {% if asset_list.has_previous %}
                                            <li class="long"><a
                                                    href="?{{ asset_list.previous_page_number.querystring }}">上一页</a>
                                            </li>
                                        {% endif %}
                                        {% for page in asset_list.pages %}
                                            {% if page %}
                                                {% ifequal page asset_list.number %}
                                                    <li class="active"><a href="?{{ page.querystring }}">{{ page }}</a>
                                                    </li>
                                                {% else %}
                                                    <li><a href="?{{ page.querystring }}">{{ page }}</a>
                                                {% endifequal %}
                                            {% else %}
                                                <li class="none"><a href="">...</a></li>
                                            {% endif %}
                                        {% endfor %}
                                        {% if asset_list.has_next %}
                                            <li class="long"><a
                                                    href="?{{ asset_list.next_page_number.querystring }}">下一页</a></li>
                                        {% endif %}
                                    </ul>
</div>
         </div>

    </div>


{% endblock %}


{% block footer_js %}

    <script src="{% static 'js/plugins/dataTables/datatables.min.js' %}"></script>
{#    <script src="{% static 'js/plugins/iCheck/icheck.min.js' %}"></script>#}


   <!-- 确定删除弹出框 -->
   <script>
            $(function () {
                $('.asset_del').click(function () {
                    var nid = $(this).attr('id');
                        console.log(nid);
                    swal({
                        title: "你确定删除",
                        text: "你将无法恢复",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "确定",
                        closeOnConfirm: false
                    }, function () {

                        $.ajax({
                            url: "{% url 'asset:del_asset'  %}",
                            type: 'POST',
                            data: {'nid': nid },
                            success: function (data) {

                                var obj = JSON.parse(data);
                                if (obj.status) {
                                    swal({title: "删除", text: "已成功删除",imageUrl: "{% static 'img/thumbs-up.jpg' %}"}, function () {
                                        location.href = "{% url "asset:asset_list" %}"
                                    })

                                } else {
                                    swal("错误", "删除" + "[ " + obj.error + " ]" + "遇到错误", "error");
                                }
                            }
                        });
                    });
                });
            });
        </script>
{# <!-- 添加记录提交 -->#}
{#  <script>#}
{#      $(function () {#}
{#          // 提交表单#}
{#          $('#js_addHostBtn').on('click', function () {#}
{#              $.ajax({#}
{#                  cache: false,#}
{#                  type: "POST",#}
{#                  url: "{% url 'asset:asset_add' %}",#}
{#                  data: $('#js_addHostForm'),#}
{#                  async: true,#}
{#                  success: function (data) {#}
{#                      if (data.status == 'success') {#}
{#                          window.location.href = "{% url 'asset:asset_list' %}";#}
{#                          window.alert(data.msg);#}
{#                      } else if (data.status == 'fail') {#}
{#                              window.location.reload();#}
{#                          window.alert(data.msg);#}
{#                      }#}
{#                  }#}
{#              });#}
{#          });#}
{#      })#}
{#  </script>#}
{% endblock %}
