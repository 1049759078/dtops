{% extends '_base.html' %}
{% load staticfiles %}

{% block title %}DtOps | 系统用户列表{% endblock %}
{% block custom_css %}
    <link href="{% static 'css/plugins/dataTables/datatables.min.css' %}" rel="stylesheet"
{% endblock %}

{% block content %}
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
            <h2>系统用户列表</h2>
            <ol class="breadcrumb">
                <li>
                    <a href="{% url 'index' %}">总览</a>
                </li>
                <li>
                    <a>系统用户列表</a>
                </li>
            </ol>
        </div>
        <div class="col-lg-2">

        </div>
    </div>
    <div class="alert alert-info">
    系统用户指连接服务器的用户,如root,Dtops用该用户来和服务器交互
    </div>
    <div class="ibox-content">
        <div class="" id="content_start">
            <div class="html5buttons">
                <div class="dt-buttons btn-group">
                    <a class="btn btn-default btn_import" data-toggle="modal" data-target="#user_import_modal"
                       tabindex="0">
                        <span>导入</span>
                    </a>
                    <a class="btn btn-default btn_export" tabindex="0">
                        <span>导出</span>
                    </a>
                </div>
            </div>

        </div>

        <div class="uc pull-left m-r-5"><a href="{% url 'asset:sysuser_create' %}" class="btn btn-sm btn-primary">
            新建系统用户 </a></div>
        <div id="user_list_table_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
            <div id="uc" class="pull-left"></div>
            <form method="get" action="{% url 'asset:asset_list' %}" class="form-horizontal">
            <div id="user_list_table_filter" class="dataTables_filter">
                <label>搜索</label>
                    <input type="search" class="form-control input-sm" name="search" placeholder="请输入..." aria-controls="user_list_table">

            </div>
            </form>

            <table class="table table-striped table-bordered table-hover  dataTable no-footer dataTables-asset">
                <thead>
                <tr role="row">
                    {#            <th class="text-center sorting_disabled" rowspan="1" colspan="1" aria-label="" style="width: 75px;">#}
                    {#                <input id="" type="checkbox" class="ipt_check_all">#}
                    {#            </th>#}
                    <th width="20" class="text-center"><input type="checkbox" id="CheckedAll"></th>
                    <th class="text-center sorting">名称</th>
                    <th class="text-center sorting">用户名</th>
                    <th class="text-center sorting">关联资产</th>
           <th class="text-center sorting">创建用户</th>
                    <th class="text-center sorting">备注</th>



                    {#            <th class="text-center sorting" tabindex="0" aria-controls="user_list_table" rowspan="1" colspan="1" aria-label="激活中: activate to sort column ascending" style="width: 200px;">激活中</th>#}
                    <th class="text-center sorting">动作</th>
                </tr>
                </thead>

                <tbody>
                {% for system_user_list in system_user_list.object_list %}
                    <tr role="row" class="gradeA" id="{{ system_user_list.id }}">

                        {#        <td class=" text-center">#}
                        {#         <input type="checkbox" class="text-center ipt_check" id="{{ user_list.id }}">#}
                        {#        </td>#}
                        <td class=" text-center"><input type="checkbox" value="{{ system_user_list.id }}" name="id"></td>
                        <td class=" text-center"><a href="{% url 'asset:system_user_detail'  system_user_list.id  %}">{{ system_user_list.name }}</a></td>
                        <td class=" text-center">{{ system_user_list.username }}</td>
                        <td class=" text-center">{{ system_user_list.asset_set.all.count }}</td>

                              <td class=" text-center">{{ system_user_list.create_user }}</td>
                              <td class=" text-center">{{ system_user_list.detail }}</td>




                        <td class=" text-center">
                            <a href="{%  url 'asset:system_user_detail' system_user_list.id  %}" class="btn btn-xs btn-info">详情</a>
                            <button class="btn btn-xs btn-danger m-l-xs user_del1 del2" id="{{ system_user_list.id }}">删除</button>

                            {#              <button class="btn btn-xs btn-danger m-l-xs system_user_del" id="{{ user_list.id }}">删除</button>#}
                        </td>
                    </tr>
                    </tbody>
                    {#    <div class="row m-t"><div class="col-md-8"><div id="op" class="col-md-6">#}
                {% endfor %}
        </div>
    </div>


{% endblock %}

<!-- Mainly scripts -->

{% block footer_js %}

    <script src="{% static 'js/plugins/dataTables/datatables.min.js' %}"></script>
    <script src="{% static 'js/plugins/iCheck/icheck.min.js' %}"></script>
      <!-- 确定删除弹出框 -->
   <script>
            $(function () {
                $('.user_del1').click(function () {
                    var nid = $(this).attr('id');
                        console.log(nid);
                    swal({
                        title: "你确定删除",
                        text: "你将无法恢复",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "确定",
                        closeOnConfirm: false
                    }, function () {

                        $.ajax({
                            headers: {"X-CSRFToken": '{{ csrf_token }}'},
                            url: "{% url 'asset:del_sysuser'  %}",
                            type: 'POST',
                            data: {'nid': nid },
                            success: function (data) {

                                var obj = JSON.parse(data);
                                if (obj.status) {
                                    swal({title: "删除", text: "已成功删除",imageUrl: "{% static 'img/thumbs-up.jpg' %}"}, function () {
                                        location.href = "{% url "asset:system_user" %}"
                                    })

                                } else {
                                    swal("错误", "删除" + "[ " + obj.error + " ]" + "遇到错误", "error");
                                }
                            }
                        });
                    });
                });
            });
        </script>
{#    <script>#}
{#        $(document).ready(function () {#}
{#            $('.i-checks').iCheck({#}
{#                checkboxClass: 'icheckbox_square-green',#}
{#                radioClass: 'iradio_square-green',#}
{#            });#}
{#        });#}
{#    </script>#}
{#    <script type="text/JavaScript">#}
{#        $.ajaxSetup({#}
{#            headers: {#}
{#                "X-CSRFToken": '{{ csrf_token }}'#}
{#            }#}
{#        });#}
{##}
{##}
{#        $(document).ready(function () {#}
{#            $('.dataTables-asset').DataTable({#}
{##}
{#                "oLanguage": {#}
{#                    "sLengthMenu": "每页显示 _MENU_ 条记录",#}
{#                    "sZeroRecords": "对不起，查询不到任何相关数据",#}
{#                    "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_条记录",#}
{#                    "sInfoEmtpy": "找不到相关数据",#}
{#                    "sInfoFiltered": " 数据表中共为 _MAX_ 条记录",#}
{#                    "sProcessing": "正在加载中...",#}
{#                    "sSearch": "搜索",#}
{#                    "oPaginate": {#}
{#                        "sFirst": "第一页",#}
{#                        "sPrevious": " 上一页 ",#}
{#                        "sNext": " 下一页 ",#}
{#                        "sLast": " 最后一页 "#}
{#                    }#}
{#                },#}
{#                "order": [[1, 'desc']],#}
{#                destroy: true,#}
{##}
{##}
{#                bPaginate: false,#}
{#                dom: '<"html5buttons"B>lTfgitp,'#}
{##}
{#            });#}
{#        });#}
{##}
{##}
{#    </script>#}
{#   <script>#}
{#            $(function () {#}
{#                $('.user_del1').click(function () {#}
{#                    var nid = $(this).attr('id');#}
{#                        console.log(nid);#}
{#                    swal({#}
{#                        title: "你确定删除",#}
{#                        text: "你将无法恢复",#}
{#                        type: "warning",#}
{#                        showCancelButton: true,#}
{#                        confirmButtonColor: "#DD6B55",#}
{#                        confirmButtonText: "确定",#}
{#                        closeOnConfirm: false#}
{#                    }, function () {#}
{##}
{#                        $.ajax({#}
{#                            url: "{% url 'users:user_del'  %}",#}
{#                            type: 'POST',#}
{#                            data: {'nid': nid },#}
{#                            success: function (data) {#}
{##}
{#                                var obj = JSON.parse(data);#}
{#                                if (obj.status) {#}
{#                                    swal({title: "删除", text: "已成功删除",imageUrl: "{% static 'img/thumbs-up.jpg' %}"}, function () {#}
{#                                        location.href = "{% url "users:user_list" %}"#}
{#                                    })#}
{##}
{#                                } else {#}
{#                                    swal("错误", "删除" + "[ " + obj.error + " ]" + "遇到错误", "error");#}
{#                                }#}
{#                            }#}
{#                        });#}
{##}
{##}
{#                    });#}
{#                });#}
{##}
{#            });#}
{#        </script>#}
{% endblock %}
