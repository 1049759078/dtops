{% extends '_base.html' %}
{% load staticfiles %}

   {% block title %}DtOps | 用户列表{% endblock %}
    {% block custom_css %}
        <link href="{% static 'css/plugins/dataTables/datatables.min.css' %}" rel="stylesheet"
    {% endblock %}

{% block content %}
      <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>用户列表</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="../index.html">总览</a>
                        </li>
                        <li>
                            <a>用户列表</a>
                        </li>
{#                        <li class="active">#}
{#                            <strong>数据表格</strong>#}
{#                        </li>#}
                    </ol>
                </div>
                <div class="col-lg-2">

                </div>
            </div>
{#        <div class="wrapper wrapper-content animated fadeInRight white-bg">#}
{#            <div class="row">#}
{#                <div class="col-lg-12 ">#}
{#                <div class="ibox float-e-margins">#}
{#                        <span>用户列表</span>#}
{#                        <div class="ibox-tools">#}
{#                            <a class="collapse-link">#}
{#                                <i class="fa fa-chevron-up"></i>#}
{#                            </a>#}
{#                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">#}
{#                                <i class="fa fa-wrench"></i>#}
{#                            </a>#}
{#                            <ul class="dropdown-menu dropdown-user">#}
{#                                <li><a href="#">选项 1</a>#}
{#                                </li>#}
{#                                <li><a href="#">选项 2</a>#}
{#                                </li>#}
{#                            </ul>#}
{#                            <a class="close-link">#}
{#                                <i class="fa fa-times"></i>#}
{#                            </a>#}
{##}
{#                    </div>#}
{##}
{#                        <div class="ibox-content">#}
{#                            <div class="text-left">#}
{#                            <a data-toggle="modal" class="btn btn-sm btn-primary" href="#modal-form">添加用户</a>#}
{#                            </div>#}
{#                            <div id="modal-form" class="modal fade" aria-hidden="true">#}
{#                                <div class="modal-dialog">#}
{#                                    <div class="modal-content">#}
{#                                        <div class="modal-body">#}
{#                                            <div class="row">#}
{#                                                <div class="col-sm-12 b-r"><h3 class="m-t-none m-b">用户创建</h3>#}
{#                                                    <form id="jsResetPwdForm" role="form" autocomplete="off">#}
{#                                                           {% csrf_token %}#}
{#                                                        <div class="form-group"><label>电子邮件</label> <input type="email" placeholder="请输入电子邮件" class="form-control"></div>#}
{#                                                        <div class="form-group"><label>密码</label> <input type="password" placeholder="请输入密码" class="form-control"></div>#}
{#                                                        <div class="form-group"><label>密码</label> <input type="username" placeholder="请输入密码" class="form-control"></div>#}
{#                                                        <div class="form-group"></div>#}
{#                                                        {{ form.as_p }}#}
{#                                                        {{ form.non_field_errors }}#}
{#                                                        {{ form.errors }}#}
{#                                                        <div class=" modal-footer ">#}
{#                                                            <button type="button" class="btn btn-sm btn-primary btn-minor  m-t-n-xs " data-dismiss="modal"><strong>取消</strong></button>#}
{#                                                            <button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="submit" id="jsResetPwdBtn"><strong>提交</strong></button>#}
{#                                                             <input type="hidden" name="next" value="{{ redirect_url }}" />#}
{#                                                            <button type="button" class="btn btn-sm btn-primary m-t-n-xs btn-sm demo1" data-dismiss="modal"><strong>取消</strong></button>#}
{#                                                            <button type="submit" class="btn btn-sm btn-primary pull-right m-t-n-xs"><strong>提交</strong></button>#}
{#                                                        </div>#}
{##}
{#                                                    </form>#}
{#                                                </div>#}
{#                                                <div class="col-sm-6"><h4>非平台会员?</h4>#}
{#                                                    <p>您可以创建一个帐户:</p>#}
{#                                                    <p class="text-center">#}
{#                                                        <a href=""><i class="fa fa-sign-in big-icon"></i></a>#}
{#                                                    </p>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                    </div>#}
{#                                </div>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}

                <div class="ibox-content">
                    <div class="" id="content_start">


    <div class="html5buttons">
        <div class="dt-buttons btn-group">
            <a class="btn btn-default btn_import" data-toggle="modal" data-target="#user_import_modal" tabindex="0">
                <span>导入</span>
            </a>
            <a class="btn btn-default btn_export" tabindex="0">
                <span>导出</span>
            </a>
        </div>
    </div>

                    </div>

<div class="uc pull-left m-r-5"><a href="{% url 'users:create_user' %}" class="btn btn-sm btn-primary"> 创建用户 </a></div>
<div id="user_list_table_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
    <div id="uc" class="pull-left"></div>

    <div id="user_list_table_filter" class="dataTables_filter"><label>搜索<input type="search" class="form-control input-sm" placeholder="" aria-controls="user_list_table"></label></div>
    <div class="dataTables_length" id="user_list_table_length">
        <label>每页  <select name="user_list_table_length" aria-controls="user_list_table" class="form-control input-sm">
            <option value="15">15</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="-1">All</option>
        </select></label></div>
    <table class="table table-striped table-bordered table-hover  dataTable no-footer" id="user_list_table" role="grid" aria-describedby="user_list_table_info" style="width: 1601px;">
    <thead>
        <tr role="row">
{#            <th class="text-center sorting_disabled" rowspan="1" colspan="1" aria-label="" style="width: 75px;">#}
{#                <input id="" type="checkbox" class="ipt_check_all">#}
{#            </th>#}
            <th class="text-center sorting" tabindex="0" aria-controls="user_list_table" rowspan="1" colspan="1" aria-label="昵称: activate to sort column ascending" style="width: 267px;">昵称</th>
            <th class="text-center sorting" tabindex="0" aria-controls="user_list_table" rowspan="1" colspan="1" aria-label="用户名: activate to sort column ascending" style="width: 200px;">用户名</th>
            <th class="text-center sorting" tabindex="0" aria-controls="user_list_table" rowspan="1" colspan="1" aria-label="邮箱: activate to sort column ascending" style="width: 160px;">邮箱</th>
                  <th class="text-center sorting" tabindex="0" aria-controls="user_list_table" rowspan="1" colspan="1" aria-label="管理员: activate to sort column ascending" style="width: 200px;">管理员</th>
            <th class="text-center sorting" tabindex="0" aria-controls="user_list_table" rowspan="1" colspan="1" aria-label="是否激活: activate to sort column ascending" style="width: 200px;">是否激活</th>
{#            <th class="text-center sorting" tabindex="0" aria-controls="user_list_table" rowspan="1" colspan="1" aria-label="激活中: activate to sort column ascending" style="width: 200px;">激活中</th>#}
            <th class="text-center sorting" tabindex="0" aria-controls="user_list_table" rowspan="1" colspan="1" aria-label="动作: activate to sort column ascending" style="width: 249px;">动作</th></tr>
    </thead>

    <tbody>
     {% for user_list in user_list %}
    <tr role="row" class="odd gradeA" id="{{ user_list.id }}">

{#        <td class=" text-center">#}
{#         <input type="checkbox" class="text-center ipt_check" id="{{ user_list.id }}">#}
{#        </td>#}
        <td class=" text-center"><a href="">{{ user_list.nick_name }}</a></td>
        <td class=" text-center">{{ user_list.username }}</td>
         <td class=" text-center">{{ user_list.email }}</td>

        <td class=" text-center">{% if user_list.is_superuser == 1 %}是{% else %}否{% endif %}</td>
        <td class=" text-center"><i {%  if user_list.is_active %}class="fa fa-check text-navy"{% else %}class="fa fa-toggle-down text-warning"{% endif %} ></i></td>

        <td class=" text-center">
            <a href="" class="btn btn-xs btn-info">更新</a>
            <a href="{% url 'users:user_delete' user_list.id  %}" class="btn btn-xs btn-danger m-l-xs " >删除</a>
{#              <button class="btn btn-xs btn-danger m-l-xs system_user_del" id="{{ user_list.id }}">删除</button>#}
        </td>
         </tr>
            </tbody>
{#    <div class="row m-t"><div class="col-md-8"><div id="op" class="col-md-6">#}
    {% endfor %}
        </div>
                </div>
{#    <div class="input-group">#}
{#        <select class="form-control m-b" style="width: auto" id="slct_bulk_update">#}
{#            <option value="delete">批量删除</option>#}
{#            <option value="update">批量更新</option>#}
{#            <option value="deactive">禁用所选</option>#}
{#            <option value="active">激活所选</option>#}
{#        </select>#}
{#        <div class="input-group-btn pull-left" style="padding-left: 5px;">#}
{#            <button id="btn_bulk_update" style="height: 32px;" class="btn btn-sm btn-primary">#}
{#             提交#}
{#            </button>#}
{#        </div>#}
{#    </div>#}
{#</div><div class="col-md-6 text-center"><div class="dataTables_info" id="user_list_table_info" role="status" aria-live="polite">显示第 1 至 1 项结果; 总共 1 项</div></div></div><div class="col-md-4"><div class="dataTables_paginate paging_simple_numbers" id="user_list_table_paginate"><ul class="pagination"><li class="paginate_button previous disabled" id="user_list_table_previous"><a href="#" aria-controls="user_list_table" data-dt-idx="0" tabindex="0">‹</a></li><li class="paginate_button active"><a href="#" aria-controls="user_list_table" data-dt-idx="1" tabindex="0">1</a></li><li class="paginate_button next disabled" id="user_list_table_next"><a href="#" aria-controls="user_list_table" data-dt-idx="2" tabindex="0">›</a></li></ul></div></div></div></div>#}
{#<div id="actions" class="hide">#}
{#    <div class="input-group">#}
{#        <select class="form-control m-b" style="width: auto" id="slct_bulk_update">#}
{#            <option value="delete">批量删除</option>#}
{#            <option value="update">批量更新</option>#}
{#            <option value="deactive">禁用所选</option>#}
{#            <option value="active">激活所选</option>#}
{#        </select>#}
{#        <div class="input-group-btn pull-left" style="padding-left: 5px;">#}
{#            <button id="btn_bulk_update" style="height: 32px;" class="btn btn-sm btn-primary">#}
{#             提交#}
{#            </button>#}
{#        </div>#}
{#    </div>#}
{#</div>#}



{##}
{#                    <div class="row">#}
{#                        <div class="col-sm-4">#}
{##}
{#                        </div>#}



{#<script>#}
{#    $(document).ready(function () {#}
{#        $('.page').click(function () {#}
{#            var searchStr = location.search;#}
{#            var old_href = $(this).attr('href').replace('?', '');#}
{#            var searchArray = searchStr.split('&');#}
{##}
{#            if (searchStr == '') {#}
{#                searchStr = '?page=1'#}
{#            }#}
{##}
{#            if (searchStr.indexOf('page') >= 0) {#}
{#                searchArray.pop();#}
{#            }#}
{##}
{#            searchArray.push(old_href);#}
{#            if (searchArray.length > 1) {#}
{#                $(this).attr('href', searchArray.join('&'));#}
{#            }#}
{#        })#}
{#    });#}
{##}
{#</script>#}






{#                <div class="table-responsive">#}
{#                    <table class="table table-striped table-bordered table-hover dataTables-example" >#}
{#                    <thead>#}
{#                    <tr>#}
{#                        <th>ID</th>#}
{#                        <th>昵称</th>#}
{#                        <th>账号</th>#}
{#                        <th>邮箱</th>#}
{#                        <th>是否激活</th>#}
{#                        <th>动作</th>#}
{##}
{#                    </tr>#}
{#                    </thead>#}
{#                    <tbody>#}
{#                     {% for user_list in user_list %}#}
{#                    <tr class="gradeX">#}
{##}
{#                        <td>{{ forloop.counter }}</td>#}
{#                        <td>{{ user_list.nick_name }}</td>#}
{#                        <td>{{ user_list.username }}</td>#}
{#                     <td>{{ user_list.email }}</td>#}
{#                            <td>{%  if user_list.is_active %}是{% else %}否{% endif %} </td>#}
{#                        <td></td>#}
{#                        <td class="center">4</td>#}
{#                        <td class="center">X</td>#}
{#                                                                <td><a class="btn btn-primary  btn-xs"#}
{#                                               href="">编辑</a>#}
{#                                            <button class="btn btn-danger  btn-xs  system_user_del"#}
{##}
{#                                                 >删除#}
{#                                            </button>#}
{#                                        </td>#}
{##}
{#                    </tr>#}
{#  {% endfor %}#}
{#                    </tbody>#}
{#                    </table>#}
{#                        </div>#}
{##}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#            </div>#}
{#        </div>#}




{% endblock %}

    <!-- Mainly scripts -->

{% block footer_js %}

    <script src="{% static 'js/plugins/dataTables/datatables.min.js' %}"></script>
        <script src="{% static 'js/plugins/iCheck/icheck.min.js' %}"></script>
     <script>
            $(document).ready(function () {
                $('.i-checks').iCheck({
                    checkboxClass: 'icheckbox_square-green',
                    radioClass: 'iradio_square-green',
                });
            });
        </script>
      <script type="text/JavaScript">
    $.ajaxSetup({headers: {"X-CSRFToken": '{{ csrf_token }}'
    }});
        </script>

    <!-- Page-Level Scripts -->
{#    <script>#}
{#        $(document).ready(function(){#}
{#            $('.dataTables-example').DataTable({#}
{#                pageLength: 25,#}
{#                responsive: true,#}
{#                dom: '<"html5buttons"B>lTfgitp',#}
{#                buttons: [#}
{#                    { extend: 'copy'},#}
{#                    {extend: 'csv'},#}
{#                    {extend: 'excel', title: 'ExampleFile'},#}
{#                    {extend: 'pdf', title: 'ExampleFile'},#}
{##}
{#                    {extend: 'print',#}
{#                     customize: function (win){#}
{#                            $(win.document.body).addClass('white-bg');#}
{#                            $(win.document.body).css('font-size', '10px');#}
{##}
{#                            $(win.document.body).find('table')#}
{#                                    .addClass('compact')#}
{#                                    .css('font-size', 'inherit');#}
{#                    }#}
{#                    }#}
{#                ]#}
{##}
{#            });#}
{##}
{#        });#}
{#        $(function(){#}
{#    //个人资料修改密码#}
{#    $('#jsUserResetPwd').on('click', function(){#}
{#        Dml.fun.showDialog('#jsResetDialog', '#jsResetPwdTips');#}
{#    });#}

{#    $('#jsResetPwdBtn').click(function(){#}
{#        $.ajax({#}
{#            cache: false,#}
{#            type: "POST",#}
{#            dataType:'json',#}
{#            url:"{% url 'users:create_user' %}",#}
{#            data:$('#jsResetPwdForm').serialize(),#}
{#            async: true,#}
{#            beforeSend:function(xhr, settings){#}
{#                xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");#}
{#        },#}
{#            success: function(data) {#}
{##}
{#             if(data.status == 'success') {#}
{#                 alert("创建成功");#}
{#                 window.location.reload();//刷新当前页面.#}
{#             }else if(data.status == 'fail'){#}
{#                 alert("评论错误，请重新评论");}#}
{##}
{#             };#}
{#            };#}
{#                if(data.password1){#}
{#                    Dml.fun.showValidateError($("#pwd"), data.password1);#}
{#                }else if(data.password2){#}
{#                    Dml.fun.showValidateError($("#repwd"), data.password2);#}
{#                }else if(data.status == "success"){#}
{#                    Dml.fun.showTipsDialog({#}
{#                        title:'提交成功',#}
{#                        h2:'修改密码成功，请重新登录!',#}
{#                    });#}
{#                    Dml.fun.winReload();#}
{#                }else if(data.msg){#}
{#                    Dml.fun.showValidateError($("#pwd"), data.msg);#}
{#                    Dml.fun.showValidateError($("#repwd"), data.msg);#}
{#                }#}
{#            }#}
{#        });#}
{#    });#}

{#      function doDelete() {#}
{#        swal({#}
{#            title: '确定删除?',#}
{#            type: "warning",#}
{#            showCancelButton: true,#}
{#            confirmButtonColor: "#DD6B55",#}
{#            confirmButtonText: "确认",#}
{#            closeOnConfirm: false#}
{#        }, function() {#}
{#            var success = function() {#}
{#                var msg = "删除用户";#}
{#                swal("用户删除", msg, "success");#}
{#                $('#user_list_table').DataTable().ajax.reload();#}
{#            };#}
{#            var fail = function() {#}
{#                var msg = "用户删除失败";#}
{#                swal("用户删除", msg, "error");#}
{#            };#}
{#            var url_delete = the_url + '?id__in=' + JSON.stringify(plain_id_list);#}
{#            APIUpdateAttr({url: url_delete, method: 'DELETE', success: success, error: fail});#}
{#            jumpserver.checked = false;#}
{#        });#}
{#    }switch(action) {#}
{##}
{#        case 'delete':#}
{#            doDelete();#}
{#            break;#}
{#    }#}
{##}
{#    </script>#}



{#   <script>#}
{#            $(function () {#}
{##}
{#                $('system_user_del').click(function () {#}
{#                    var id = $(this).parent().parent().attr('id');#}
{##}
{#                    swal({#}
{#                        title: "你确定删除",#}
{#                        text: "你将无法恢复",#}
{#                        type: "warning",#}
{#                        showCancelButton: true,#}
{#                        confirmButtonColor: "#DD6B55",#}
{#                        confirmButtonText: "确定",#}
{#                        closeOnConfirm: false#}
{#                    }, function () {#}
{#                        $.ajax({#}
{#                              url: "{% url 'users:user_delete' id %} ",#}
{#                             type: 'POST',#}
{#                             data: {'nid_pk': id},#}
{#                            success: function (data) {#}
{#                                var obj = JSON.parse(data);#}
{#                                if (obj.status) {#}
{#                                    swal({title: "删除", text: "已成功删除", type: "success"}, function () {#}
{#                                        console.log(id);#}
{#                                        window.location.reload();#}
{#                                    })#}
{#                                } else {#}
{#                                    swal("错误", "删除" + "[ " + obj.error + " ]" + "遇到错误", "error");#}
{#                                }#}
{#                            }#}
{#                        });#}
{##}
{##}
{#                    });#}
{#                });#}
{##}
{##}
{##}
{#                });#}
{##}
{##}
{#        </script>#}
{% endblock %}